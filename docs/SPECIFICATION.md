# クリスマスビンゴ大会システム 仕様書

## 1. システム概要
本システムは、クリスマスイベント等で使用することを想定した、Webベースのビンゴ抽選システムです。
「ワクワク感」を重視し、リッチな画面演出と効果音を備えています。

## 2. アーキテクチャ
本システムは、関心の分離を意識したレイヤードアーキテクチャを採用しています。

### 全体構成
*   **フロントエンド**: Vue.js (TypeScript)
*   **バックエンド**: Rust (Axum)
*   **通信**: REST API (JSON)

### ディレクトリ構成と責務

#### バックエンド (`backend/`)
ビジネスロジックをフレームワークから分離しています。

*   `src/domain.rs`: **ドメイン層**。ビンゴのルール（数字の管理、抽選ロジック）を純粋なRustコードとして定義。
*   `src/state.rs`: **状態管理**。アプリケーション全体で共有されるメモリ内状態の定義。
*   `src/handlers.rs`: **プレゼンテーション層**。HTTPリクエストを受け取り、ドメインロジックを呼び出してレスポンスを返す。
*   `src/main.rs`: **インフラ層**。サーバーの起動、ルーティング設定。

#### フロントエンド (`frontend/`)
UIコンポーネントとロジック、通信処理を分離しています。

*   `src/components/`: **UIコンポーネント**。表示とユーザー操作の受け付けのみを担当。
*   `src/composables/`: **アプリケーションロジック**。画面の状態管理や演出の制御。
*   `src/services/`: **インフラストラクチャ**。APIサーバーとの通信処理を隠蔽。

## 3. 機能仕様

### 3.1. フロントエンド

#### 画面構成
*   **背景**: クリスマスカラー（緑・赤・金）を基調とし、雪が降るアニメーション (`SnowEffect`) を常時表示。
*   **中央表示**: 現在抽選された数字を大きく表示。
*   **操作パネル**: 「SPIN」ボタンと「RESET」ボタン。
*   **履歴エリア**: 過去に抽選された数字の一覧を表示。
*   **あみだくじ画面**: 景品抽選用のあみだくじ機能。

#### 機能詳細
1.  **抽選 (SPIN)**
    *   「SPIN」ボタン押下で開始。
    *   **演出**: 数字が高速で切り替わるルーレットアニメーション（約3秒間）。徐々に減速する。
    *   **音響**: Web Audio APIを使用。回転中はビープ音、確定時はファンファーレ（和音）を再生。
    *   **結果**: バックエンドから取得した確定数字を表示。

2.  **リセット (RESET)**
    *   「RESET」ボタン押下で確認ダイアログを表示。
    *   承認後、バックエンドの状態を初期化し、画面表示も初期状態（"Merry Christmas!"）に戻す。

3.  **履歴表示**
    *   抽選された数字を即座に履歴リストに追加表示。

4.  **シード値表示**
    *   公平性を担保するため、抽選に使用されている乱数シード値を画面右下に表示。

5.  **あみだくじ (Amidakuji)**
    *   **設定画面 (`/amida`)**: 10個の景品名を入力可能。
    *   **ゲーム画面 (`/amida/result`)**:
        *   入力された景品が上部にボタンとして表示される。
        *   ボタンをクリックすると、ランダムに生成されたあみだくじのアニメーションが開始される。
        *   下部の数字（1〜10）に到達し、結果が確定する。
        *   あみだくじの線の配置は、ゲーム画面を開くたびにクライアントサイドでランダムに生成される（サーバーには保存されない）。
        *   景品名はサーバーに保存され、リロードしても保持される。

### 3.2. バックエンド

#### データ管理
*   **数字の範囲**: 1 〜 75 (一般的なビンゴのルール)
*   **重複排除**: 抽選された数字はリストから除外され、二度と出現しないことを保証。
*   **ランダム性**: 
    *   外部ファイル (`seeds.txt`) から読み込んだ数値を元にシード値を計算。
    *   XorShiftアルゴリズムを使用して乱数を生成。
    *   これにより、運営による恣意的な操作を排除し、再現性と透明性を確保。
*   **あみだくじデータ**:
    *   景品名リスト（10個）のみを保持。
    *   あみだくじの構造や結果は保持しない（クライアントサイドで完結）。

#### 状態保持
*   サーバーのメモリ上で状態（残りの数字、履歴、シード値、あみだくじの景品）を保持する。
*   ※ サーバーを再起動すると状態はリセットされる。

## 4. 技術スタック

### バックエンド
*   **言語**: Rust (Edition 2021)
*   **Webフレームワーク**: Axum 0.7
*   **非同期ランタイム**: Tokio
*   **シリアライズ**: Serde / Serde JSON
*   **乱数生成**: Rand

### フロントエンド
*   **フレームワーク**: Vue.js 3.5 (Composition API)
*   **言語**: TypeScript
*   **ビルドツール**: Vite
*   **音声**: Web Audio API (外部ライブラリ不使用)
